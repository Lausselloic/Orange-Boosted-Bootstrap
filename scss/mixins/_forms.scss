// This mixin uses an `if()` technique to be compatible with Dart Sass
// See https://github.com/sass/sass/issues/1873#issuecomment-152293725 for more details
@mixin form-validation-state-selector($state) {
  @if ($state == "valid" or $state == "invalid") {
    .was-validated #{if(&, "&", "")}:#{$state},
    #{if(&, "&", "")}.is-#{$state} {
      @content;
    }
  } @else {
    #{if(&, "&", "")}.is-#{$state} {
      @content;
    }
  }
}

@mixin form-validation-state($state, $color, $icon) {
  // Boosted mod: valid â‰  invalid
  @if $state == "valid" {
    .#{$state}-feedback {
      display: none;
      @extend .sr-only; // Boosted mod: Do not visually display .valid-feedback
    }

    @if $enable-validation-icons {
      .form-control {
        @include form-validation-state-selector($state) {
          background: escape-svg($icon) no-repeat right map-get($spacers, 2) center / $spacer;
        }
      }
    }
  } @else {
    .#{$state}-feedback {
      display: none;
      width: 100%;
      margin-top: $form-feedback-margin-top;
      font-style: $form-feedback-font-style;
      @include font-size($form-feedback-font-size);
      font-weight: $font-weight-bold; // Boosted mod

      // Boosted mod: status should not rely on color only
      @if $enable-validation-icons {
        &::before {
          flex-shrink: 0;
          align-self: center;
          width: $form-feedback-icon-size;
          height: $form-feedback-icon-size;
          margin-right: map-get($spacers, 1);
          content: "";
          background: escape-svg($form-feedback-icon-invalid) no-repeat;
        }
      }
    }

    // Boosted mod: no .#{$state}-tooltip

    @include form-validation-state-selector($state) {
      ~ .#{$state}-feedback,
      ~ .#{$state}-tooltip {
        display: flex; // Boosted mod
      }
    }

    .form-control {
      @include form-validation-state-selector($state) {
        border-color: $color;

        // Boosted mod: validation icon in .*-feedback

        // Boosted mod: no box-shadow
        &:focus {
          border-color: $color;
        }
      }
    }

    // Boosted mod: no icon in background for textarea

    .form-select {
      @include form-validation-state-selector($state) {
        border-color: $color;

        // Boosted mod: no icon in background

        // Boosted mod: no box-shadow
        &:focus {
          border-color: $color;
        }
      }
    }

    .form-check-input {
      @include form-validation-state-selector($state) {
        border-color: $color;

        // Boosted mod: flat background
        &:checked,
        &:active {
          background-color: $color;
        }

        // Boosted mod: no box-shadow

        // Boosted mod: label's color doesn't change
      }
    }
    .form-check-inline .form-check-input {
      ~ .#{$state}-feedback {
        margin-left: .5em;
      }
    }

    // custom file
    .form-file-input {
      @include form-validation-state-selector($state) {
        ~ .form-file-label {
          border-color: $color;
        }

        &:focus {
          ~ .form-file-label {
            border-color: $color;
            // Boosted mod: no box-shadow
          }
        }
      }
    }
  }
  // End mod
}
